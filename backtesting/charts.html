<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <title>ECharts</title>
    <script src="https://cdn.staticfile.org/echarts/5.0.2/echarts.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/vue/2.2.2/vue.min.js"></script>
</head>
<body>
    <div id="main" style="width:1024px; height:768px;"></div>
    <script type="text/javascript">

        function arrToNumber(arr) {
            return arr.map(Number).filter(Boolean);
        }

        var myChart = echarts.init(document.getElementById('main'));
        myChart.showLoading();

        $.get('http://127.0.0.1:5926/backtesting', function(datas) {
            myChart.hideLoading();
            datas = JSON.parse(datas);

            source = [];
            datas.map(function(item, index, _) {
                source.push(arrToNumber(item));
            });
            const dimensions = ['time', 'price', 'ask', 'bid'];

            myChart.setOption({
                title: {text: 'backtesting'},
                dataset: {
                    dimensions: dimensions,
                    source: source
                },
                grid: {
                    containLabel: true
                },
                xAxis: {
                    type: 'time',
                    name: 'time',
                    scale: true,
                    splitLine: { show: false },
                    splitNumber: 13,
                    axisLabel: {
                        rotate: 45,
                        interval: 0,
                        formatter: function(value, index) {
                            return new Date(value).toISOString().substring(0, 19);
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'trend',
                    scale: true,
                    max: 'dataMax',
                    min: 'dataMin',
                    axisLine: {show: true}
                },
                tooltip: {
                    show: true, // 提示框，鼠标悬浮交互时的信息提示，是否显示
                    trigger: 'axis', // 触发类型，默认数据触发，可选为：'item' | 'axis'
                },
                legend: {
                    data: ['price']
                },
                series: [
                    {
                        name: 'price',
                        type: 'scatter',
                        symbolSize: 3,
                        encode: {
                            x: 'time',
                            y: 'price'
                        }
                    }
                ],
                dataZoom: [
                    {
                        type: 'slider'
                    },
                    {
                        type: 'inside',
                        zoomOnMouseWheel:'alt'
                    }
                ],
                toolbox: {
                    orient: 'horizontal',
                    feature:{
                        restore: {
                            title: "restore",   
                        }
                    },
                    itemSize: 18,
                    iconStyle: {
                        textAlign: 'right',
                    }
                }

            });
        })
    </script>
</body>
</html>
